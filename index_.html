# Create a simple, free, GitHub-API-powered recursive repo browser.
# Drop this as index.html in the repo root. It lists ALL files/folders (recursively),
# supports filtering, and shows file content with Raw/GitHub links.
owner = "ChiefTriston"
repo = "TTS-Core-Remastered-1"
branch = "main"

html = f"""<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{repo} ‚Äî Free Repo Browser</title>
  <style>
    body{{margin:0;font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif;background:#0b0d12;color:#e7e9ee}}
    a{{color:#7dd3fc;text-decoration:none}} a:hover{{text-decoration:underline}}
    header{{position:sticky;top:0;background:#0b0d12cc;backdrop-filter:blur(6px);border-bottom:1px solid #202534}}
    .wrap{{max-width:1200px;margin:0 auto;padding:12px 16px}}
    .row{{display:flex;gap:10px;align-items:center;flex-wrap:wrap}}
    .right{{margin-left:auto}}
    .btn{{border:1px solid #202534;background:#0f1422;color:#e7e9ee;border-radius:10px;padding:6px 10px;cursor:pointer}}
    .grid{{display:grid;grid-template-columns:320px 1fr;gap:12px;padding:14px 16px;max-width:1200px;margin:0 auto}}
    .card{{border:1px solid #202534;background:#111625;border-radius:12px;padding:10px}}
    .tree, .list{{list-style:none;margin:0;padding:0}}
    .node{{padding:4px 6px;border-radius:8px;display:flex;gap:8px;align-items:center}}
    .node:hover{{background:#121a2d}}
    .indent{{margin-left:18px;border-left:1px dashed #202534;padding-left:8px}}
    .mono{{font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}}
    .muted{{color:#9aa3b2}}
    input[type="search"]{{width:100%;padding:8px;border-radius:10px;border:1px solid #202534;background:#0f1422;color:#e7e9ee}}
    pre{{white-space:pre;overflow:auto;max-height:70vh;background:#0f1422;border:1px solid #202534;border-radius:10px;padding:12px}}
    .pill{{border:1px solid #202534;border-radius:999px;padding:2px 8px;font-size:12px}}
  </style>
</head>
<body>
<header>
  <div class="wrap row">
    <strong>{repo}</strong>
    <span class="pill">Free, API-powered</span>
    <a id="ghLink" class="btn right" target="_blank" rel="noopener">Open on GitHub</a>
  </div>
</header>

<main class="grid">
  <aside class="card">
    <div class="row" style="margin-bottom:8px">
      <div class="mono small">{owner}/{repo}@{branch}</div>
    </div>
    <input id="filter" type="search" placeholder="Filter files...">
    <ul id="tree" class="tree"></ul>
  </aside>
  <section class="card">
    <div class="row" style="margin-bottom:8px">
      <div class="mono" id="title">Select a file.</div>
      <a class="btn right" id="rawBtn" style="display:none" target="_blank">Open raw</a>
      <a class="btn right" id="blobBtn" style="display:none" target="_blank">Open on GitHub</a>
    </div>
    <pre id="viewer" class="mono"></pre>
    <div class="muted mono" id="note"></div>
  </section>
</main>

<script>
(function(){{
  const owner="{owner}", repo="{repo}", branch="{branch}";
  const apiRoot = `https://api.github.com/repos/${{owner}}/${{repo}}/contents/`;
  const rawRoot = `https://raw.githubusercontent.com/${{owner}}/${{repo}}/${{branch}}/`;
  const blobRoot = `https://github.com/${{owner}}/${{repo}}/blob/${{branch}}/`;
  document.getElementById("ghLink").href = `https://github.com/${{owner}}/${{repo}}`;

  const treeEl = document.getElementById("tree");
  const viewer = document.getElementById("viewer");
  const title = document.getElementById("title");
  const note = document.getElementById("note");
  const rawBtn = document.getElementById("rawBtn");
  const blobBtn = document.getElementById("blobBtn");
  const filter = document.getElementById("filter");

  function li(html){{ const el=document.createElement('li'); el.innerHTML=html; return el; }}
  function esc(s){{ return (s||'').replace(/[&<>]/g, m=>({{ '&':'&amp;','<':'&lt;','>':'&gt;' }}[m])); }}
  async function get(path=""){{
    const url = apiRoot + path;
    const r = await fetch(url); if(!r.ok) throw new Error(`HTTP ${{r.status}}`);
    return await r.json();
  }}

  async function buildTree(path="", container){{
    const entries = await get(path);
    // sort dirs first, then files
    entries.sort((a,b)=> a.type===b.type ? a.name.localeCompare(b.name) : (a.type==='dir'?-1:1));
    for(const e of entries){{
      if(filter.value && !e.name.toLowerCase().includes(filter.value.toLowerCase())) continue;
      if(e.type==='dir'){{ // folder
        const item = li(`<div class="node"><span>üìÅ</span><a href="#" data-path="${{e.path}}" data-type="dir">${{esc(e.name)}}</a></div>`);
        const sub = document.createElement('ul'); sub.className='tree indent'; item.appendChild(sub);
        container.appendChild(item);
        // Lazy expand on click
        item.querySelector('a').addEventListener('click', async (ev)=>{{
          ev.preventDefault();
          if(sub.childElementCount===0) {{ await buildTree(e.path, sub); }}
          sub.style.display = sub.style.display==='none' ? '' : 'none';
        }});
      }} else {{ // file
        const item = li(`<div class="node"><span>üìÑ</span><a href="#" data-path="${{e.path}}" data-type="file">${{esc(e.name)}}</a></div>`);
        container.appendChild(item);
        item.querySelector('a').addEventListener('click', (ev)=>{{ev.preventDefault(); viewFile(e.path);}});
      }}
    }}
  }}

  async function init(){{
    treeEl.innerHTML = "";
    await buildTree("", treeEl);
  }}

  async function viewFile(path){{
    title.textContent = path;
    const raw = rawRoot + path;
    const blob = blobRoot + path;
    rawBtn.href = raw; rawBtn.style.display='';
    blobBtn.href = blob; blobBtn.style.display='';
    viewer.textContent = "Loading..."; note.textContent="";
    try{{
      const r = await fetch(raw);
      const size = +r.headers.get('Content-Length') || 0;
      if(size > 900000){{ // ~900 KB
        viewer.textContent = "";
        note.textContent = "File too large to render inline. Use Open raw / Open on GitHub.";
        return;
      }}
      const text = await r.text();
      viewer.textContent = text;
    }}catch(err){{
      viewer.textContent = "Failed to load file."; note.textContent = String(err);
    }}
  }}

  filter.addEventListener('input', ()=> init());
  init();
}})();
</script>
</body>
</html>
"""
open('/mnt/data/index_recursive.html','w',encoding='utf-8').write(html)
print("Wrote /mnt/data/index_recursive.html")
